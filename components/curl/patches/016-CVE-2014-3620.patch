Description: Reject incoming cookies set for TLDs
Origin: upstream, http://curl.haxx.se/libcurl-cookie-leak.patch
Forwarded: not-needed
Author: Daniel Stenberg <daniel@haxx.se>
Last-Update: 2014-09-06

--- lib/cookie.c
+++ lib/cookie.c
@@ -350,6 +350,7 @@
           }
           else {
             bool is_ip;
+            const char *dotp;
 
             /* Now, we make sure that our host is within the given domain,
                or the given domain is not valid and thus cannot be set. */
@@ -359,6 +360,11 @@
 
             is_ip = isip(domain ? domain : whatptr);
 
+            /* check for more dots */
+            dotp = strchr(whatptr, '.');
+            if(!dotp)
+              domain=":";
+
             if(!domain
                || (is_ip && !strcmp(whatptr, domain))
                || (!is_ip && tailmatch(whatptr, domain))) {
--- tests/data/test61
+++ tests/data/test61
@@ -23,6 +23,7 @@
 Set-Cookie: test4=no; domain=nope.foo.com; path=/moo; secure
 Set-Cookie: test5=name; domain=anything.com; path=/ ; secure
 Set-Cookie: fake=fooledyou; domain=..com; path=/;
+Set-Cookie: supercookie=fooledyou; domain=.com; path=/;
 Content-Length: 4
 
 boo
