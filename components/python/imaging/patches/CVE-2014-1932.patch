https://github.com/wiredfool/Pillow/commit/1e331e3e6a40141ca8eee4f5da9f74e895423b66

--- python-imaging-1.1.7.orig/PIL/EpsImagePlugin.py
+++ python-imaging-1.1.7/PIL/EpsImagePlugin.py
@@ -44,7 +44,8 @@
 
     import tempfile, os
 
-    file = tempfile.mktemp()
+    fd, file = tempfile.mkstemp()
+    os.close(fd)
 
     # Build ghostscript command
     command = ["gs",
--- python-imaging-1.1.7.orig/PIL/IptcImagePlugin.py
+++ python-imaging-1.1.7/PIL/IptcImagePlugin.py
@@ -173,8 +173,8 @@
         self.fp.seek(offset)
 
         # Copy image data to temporary file
-        outfile = tempfile.mktemp()
-        o = open(outfile, "wb")
+        o_fd, outfile = tempfile.mkstemp(text=False)
+        o = os.fdopen(o_fd)
         if encoding == "raw":
             # To simplify access to the extracted file,
             # prepend a PPM header
--- python-imaging-1.1.7.orig/PIL/JpegImagePlugin.py
+++ python-imaging-1.1.7/PIL/JpegImagePlugin.py
@@ -344,13 +344,17 @@
         # ALTERNATIVE: handle JPEGs via the IJG command line utilities
 
         import tempfile, os
-        file = tempfile.mktemp()
-        os.system("djpeg %s >%s" % (self.filename, file))
+        f, path = tempfile.mkstemp()
+        os.close(f)
+        if os.path.exists(self.filename):
+            os.system("djpeg '%s' >'%s'" % (self.filename, path))
+        else:
+            raise ValueError("Invalid Filename")
 
         try:
-            self.im = Image.core.open_ppm(file)
+            self.im = Image.core.open_ppm(path)
         finally:
-            try: os.unlink(file)
+            try: os.unlink(path)
             except: pass
 
         self.mode = self.im.mode
--- python-imaging-1.1.7.orig/PIL/Image.py
+++ python-imaging-1.1.7/PIL/Image.py
@@ -482,14 +482,17 @@
         self.readonly = 0
 
     def _dump(self, file=None, format=None):
-        import tempfile
+        import tempfile, os
         if not file:
-            file = tempfile.mktemp()
+            f, file = tempfile.mkstemp(format or '')
+            os.close(f)
+            
         self.load()
         if not format or format == "PPM":
             self.im.save_ppm(file)
         else:
-            file = file + "." + format
+            if file.endswith(format):
+                file = file + "." + format
             self.save(file, format)
         return file
 
