From d1e670a4a8704b8708e493ab6155589bcd570608 Mon Sep 17 00:00:00 2001
From: Michal Srb <msrb@suse.com>
Date: Thu, 20 Jul 2017 13:38:53 +0200
Subject: Check for end of string in PatternMatch (CVE-2017-13720)

If a pattern contains '?' character, any character in the string is skipped,
even if it is '\0'. The rest of the matching then reads invalid memory.

Reviewed-by: Peter Hutterer <peter.hutterer@who-t.net>
Signed-off-by: Julien Cristau <jcristau@debian.org>

Index: libxfont-1.5.1/src/fontfile/fontdir.c
===================================================================
--- libxfont-1.5.1.orig/src/fontfile/fontdir.c	2017-10-06 11:44:10.771770838 -0400
+++ libxfont-1.5.1/src/fontfile/fontdir.c	2017-10-06 11:44:10.771770838 -0400
@@ -399,8 +399,10 @@ PatternMatch(char *pat, int patdashes, c
 		}
 	    }
 	case '?':
-	    if (*string++ == XK_minus)
+	    if ((t = *string++) == XK_minus)
 		stringdashes--;
+	    if (!t)
+		return 0;
 	    break;
 	case '\0':
 	    return (*string == '\0');
