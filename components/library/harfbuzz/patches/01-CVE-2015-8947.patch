From f96664974774bfeb237a7274f512f64aaafb201e Mon Sep 17 00:00:00 2001
From: Behdad Esfahbod <behdad@behdad.org>
Date: Tue, 13 Oct 2015 00:30:50 -0400
Subject: Fix another memory access issue discovered by libFuzzer

Fixes https://github.com/behdad/harfbuzz/issues/139#issuecomment-146984679

Index: harfbuzz-0.9.27/src/hb-ot-layout-gpos-table.hh
===================================================================
--- harfbuzz-0.9.27.orig/src/hb-ot-layout-gpos-table.hh	2016-08-17 11:19:51.843130963 -0400
+++ harfbuzz-0.9.27/src/hb-ot-layout-gpos-table.hh	2016-08-17 11:19:51.843130963 -0400
@@ -684,6 +684,8 @@
   inline bool sanitize (hb_sanitize_context_t *c) {
     TRACE_SANITIZE (this);
 
+    if (!c->check_struct (this)) return TRACE_RETURN (false);
+
     unsigned int len1 = valueFormat1.get_len ();
     unsigned int len2 = valueFormat2.get_len ();
     PairSet::sanitize_closure_t closure = {
@@ -693,7 +695,7 @@
       1 + len1 + len2
     };
 
-    return TRACE_RETURN (c->check_struct (this) && coverage.sanitize (c, this) && pairSet.sanitize (c, this, &closure));
+    return TRACE_RETURN (coverage.sanitize (c, this) && pairSet.sanitize (c, this, &closure));
   }
 
   protected:
