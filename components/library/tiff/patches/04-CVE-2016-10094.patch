From c7153361a4041260719b340f73f2f76b0969235c Mon Sep 17 00:00:00 2001
From: erouault <erouault>
Date: Tue, 20 Dec 2016 17:28:17 +0000
Subject: [PATCH] * tools/tiff2pdf.c: avoid potential heap-based overflow in
 t2p_readwrite_pdf_image_tile(). Fixes
 http://bugzilla.maptools.org/show_bug.cgi?id=2640

---
 ChangeLog        | 6 ++++++
 tools/tiff2pdf.c | 2 +-
 2 files changed, 7 insertions(+), 1 deletion(-)

#diff --git a/ChangeLog b/ChangeLog
#index 6be3602..91ba4e6 100644
#--- a/ChangeLog
#+++ b/ChangeLog
#@@ -1,5 +1,11 @@
# 2016-12-20 Even Rouault <even.rouault at spatialys.com>
# 
#+	* tools/tiff2pdf.c: avoid potential heap-based overflow in
#+	t2p_readwrite_pdf_image_tile().
#+	Fixes http://bugzilla.maptools.org/show_bug.cgi?id=2640
#+
#+2016-12-20 Even Rouault <even.rouault at spatialys.com>
#+
# 	* tools/tiff2pdf.c: avoid potential invalid memory read in
# 	t2p_writeproc.
# 	Fixes http://bugzilla.maptools.org/show_bug.cgi?id=2639
Index: tiff-4.0.6/tools/tiff2pdf.c
===================================================================
--- tiff-4.0.6.orig/tools/tiff2pdf.c	2017-02-24 10:18:50.045252351 -0500
+++ tiff-4.0.6/tools/tiff2pdf.c	2017-02-24 10:19:12.797535750 -0500
@@ -2887,7 +2887,7 @@
 				return(0);
 			}
 			if(TIFFGetField(input, TIFFTAG_JPEGTABLES, &count, &jpt) != 0) {
-				if (count >= 4) {
+				if (count > 4) {
                     /* Ignore EOI marker of JpegTables */
 					_TIFFmemcpy(buffer, jpt, count - 2);
 					bufferoffset += count - 2;
