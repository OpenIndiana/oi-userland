#
# CDDL HEADER START
#
# The contents of this file are subject to the terms of the
# Common Development and Distribution License (the "License").
# You may not use this file except in compliance with the License.
#
# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
# or http://www.opensolaris.org/os/licensing.
# See the License for the specific language governing permissions
# and limitations under the License.
#
# When distributing Covered Code, include this CDDL HEADER in each
# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
# If applicable, add the following below this CDDL HEADER, with the
# fields enclosed by brackets "[]" replaced with your own identifying
# information: Portions Copyright [yyyy] [name of copyright owner]
#
# CDDL HEADER END

#
# Copyright (c) 2011, 2012, Oracle and/or its affiliates. All rights reserved.
#

include ../../../make-rules/shared-macros.mk

COMPONENT_NAME=		memcached-java
COMPONENT_VERSION=	2.0.1
COMPONENT_REVISION=	1
COMPONENT_SUMMARY=	memcached client for the Java platform
COMPONENT_RELEASE=	release_$(COMPONENT_VERSION)
COMPONENT_SRC=		java_memcached-$(COMPONENT_RELEASE)
COMPONENT_ARCHIVE=	$(COMPONENT_SRC).tar.gz
COMPONENT_ARCHIVE_HASH=	\
    sha256:f0978f387cd6c42191a3ec366ecc5519f66ee03e686c5d080eb2516ebbecdcc4
COMPONENT_ARCHIVE_URL=	http://dlc.openindiana.org/oi-build/source-archives/$(COMPONENT_ARCHIVE)
COMPONENT_PROJECT_URL=  http://whalin.com/memcached/
COMPONENT_FMRI=	library/java/memcached-java
COMPONENT_CLASSIFICATION=	Development/Java
COMPONENT_LICENSE=	BSD-like

include $(WS_MAKE_RULES)/prep.mk
include $(WS_MAKE_RULES)/ant.mk
include $(WS_MAKE_RULES)/ips.mk

# Make sure we remove unneeded pieces from the source (the test dir)
# and also the existing source files which will be generated anew 
# by the build (java_memcached-release_2.0.1.jar and the javadocs dir).
# Remove these items during the prep phase, before cloney creates symlinks 
# for these SOURCE_DIR files in $(BUILD_DIR_32), at the beginning of the 
# build phase.
COMPONENT_PREP_ACTION += \
	$(RM) -r $(SOURCE_DIR)/$(COMPONENT_SRC).* \
	$(SOURCE_DIR)/src/com/danga/MemCached/test \
	$(SOURCE_DIR)/javadocs ;

COMPONENT_PRE_BUILD_ACTION += \
	$(CP) Solaris/build.xml $(BUILD_DIR_$(BITS))

COMPONENT_BUILD_ARGS = -Dver=$(COMPONENT_RELEASE)
COMPONENT_BUILD_TARGETS = package

# A new $(COMPONENT_ARCHIVE) file was generated by the
# build.  Unpack it here in the build directory.
# We will use the extracted javadocs files for the package.
COMPONENT_POST_BUILD_ACTION += \
	(cd $(BUILD_DIR_$(BITS)); \
	$(UNPACK) $(UNPACK_ARGS) $(COMPONENT_ARCHIVE); \
	$(CP) -r $(COMPONENT_SRC)/javadocs . )

# Nothing is installed into the proto area.
# All files in the package will come from the build directory.
PKG_PROTO_DIRS +=	$(BUILD_DIR_$(BITS))

# common targets

build:		$(BUILD_32)

# Nothing needed for install; all files are generated
# during the build.
install:	build

test:		$(NO_TESTS)

REQUIRED_PACKAGES += developer/build/ant
REQUIRED_PACKAGES += developer/java/openjdk8
