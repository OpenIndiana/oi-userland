Description: CVE-2016-7979: type confusion in .initialize_dsc_parser allows remote code execution
Origin: upstream, http://git.ghostscript.com/?p=ghostpdl.git;h=875a0095f37626a721c7ff57d606a0f95af03913
Bug: http://bugs.ghostscript.com/show_bug.cgi?id=697190
Bug-Debian: https://bugs.debian.org/839846
Forwarded: not-needed
Author: Ken Sharp <ken.sharp@artifex.com>
Reviewed-by: Salvatore Bonaccorso <carnil@debian.org>
Reviewed-by: Emily Ratliff <emily.ratliff@canonical.com>
Last-Update: 2016-11-30
---

--- ghostscript-9.05~dfsg.orig/psi/zdscpars.c
+++ ghostscript-9.05~dfsg/psi/zdscpars.c
@@ -130,11 +130,16 @@ zinitialize_dsc_parser(i_ctx_t *i_ctx_p)
     ref local_ref;
     int code;
     os_ptr const op = osp;
-    dict * const pdict = op->value.pdict;
-    gs_memory_t * const mem = (gs_memory_t *)dict_memory(pdict);
-    dsc_data_t * const data =
-	gs_alloc_struct(mem, dsc_data_t, &st_dsc_data_t, "DSC parser init");
+    dict *pdict;
+    gs_memory_t *mem;
+    dsc_data_t *data;
 
+    check_read_type(*op, t_dictionary);
+
+    pdict = op->value.pdict;
+    mem = (gs_memory_t *)dict_memory(pdict);
+
+    data = gs_alloc_struct(mem, dsc_data_t, &st_dsc_data_t, "DSC parser init");
     if (!data)
         return_error(e_VMerror);
     data->document_level = 0;
