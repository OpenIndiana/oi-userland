--- driver/lock-Gtk.c.~5~	2017-04-26 00:47:18.379664970 +0300
+++ driver/lock-Gtk.c	2017-04-26 01:03:22.160687783 +0300
@@ -61,6 +61,7 @@
 #include <ctype.h>
 #include <X11/Xos.h>
 #include <X11/Xlib.h>
+#include <X11/XKBlib.h>
 #include <X11/Xatom.h>
 #include <X11/Xutil.h>
 #include <X11/Xmu/WinUtil.h>
@@ -179,7 +180,7 @@
   GtkWidget *entry;
   AtkObject *atk_entry;
   GtkWidget *title_label, *msg_label, *prompt_label,
-    *user_label, *date_label, *pam_msg_label;
+    *user_label, *date_label, *pam_msg_label, *layout_label;
   AtkObject *atk_title_label, *atk_prompt_label;
   GtkWidget *button;
   GtkWidget *image;
@@ -368,6 +369,43 @@
 
   gtk_box_pack_start (GTK_BOX (vbox2), pam_msg_label, FALSE, FALSE, 0);
 
+  /* current layout */
+  {
+    XkbStateRec state;
+    Display *dpy;
+    XkbDescRec desc[1];
+    char *names[XkbNumKbdGroups];
+    gchar *s1;
+
+    dpy = gdk_x11_get_default_xdisplay();
+    memset(desc, 0, sizeof(desc));
+    desc->device_spec = XkbUseCoreKbd;
+    if (XkbGetControls(dpy, XkbGroupsWrapMask, desc) == Success) {
+      if (XkbGetNames(dpy, XkbGroupNamesMask, desc) == Success) {
+        if (XkbGetState(dpy, XkbUseCoreKbd, &state) == Success) {
+          XGetAtomNames(dpy, desc->names->groups, desc->ctrls->num_groups, names);
+          if(strlen(names[state.group]) > 2) {
+             names[state.group][2]='\0';
+          }
+          
+          s1 = g_ascii_strdown (names[state.group], -1);
+          s = g_markup_printf_escaped ("<small>Layout: %s</small>", s1);
+          layout_label = g_object_new (GTK_TYPE_LABEL,
+                                     "use-markup", TRUE,
+                                     "label", s,
+                                     NULL);
+          g_free(s1);
+          g_free(s);
+  
+          gtk_box_pack_start (GTK_BOX (vbox2), layout_label,
+                                    FALSE, FALSE, 0);
+        }
+        XkbFreeNames(desc, XkbGroupNamesMask, True);
+      }
+      XkbFreeControls(desc, XkbGroupsWrapMask, True);
+    } 
+  }
+
   /* date string */
   tm = localtime (&now);
   memset (buf, 0, sizeof (buf));
