#
# This file and its contents are supplied under the terms of the
# Common Development and Distribution License ("CDDL"). You may
# only use this file in accordance with the terms of the CDDL.
#
# A full copy of the text of the CDDL should have accompanied this
# source. A copy of the CDDL is also available via the Internet at
# http://www.illumos.org/license/CDDL.
#

#
# Copyright 2020 Alexander Pyhalov
#

BUILD_BITS=32

include ../../../make-rules/shared-macros.mk

COMPONENT_NAME=	libreoffice
COMPONENT_VERSION= 6.4.2
COMPONENT_RC_VERSION= 2
COMPONENT_FULL_VERSION=$(COMPONENT_VERSION).$(COMPONENT_RC_VERSION)
COMPONENT_SUMMARY= LibreOffice is a powerful office suite
COMPONENT_PROJECT_URL= https://www.libreoffice.org/
COMPONENT_FMRI= desktop/office/libreoffice
COMPONENT_CLASSIFICATION= Applications/Office
COMPONENT_SRC=		$(COMPONENT_NAME)-$(COMPONENT_FULL_VERSION)
COMPONENT_ARCHIVE=	$(COMPONENT_SRC).tar.xz
COMPONENT_ARCHIVE_URL= https://download.documentfoundation.org/libreoffice/src/$(COMPONENT_VERSION)/$(COMPONENT_ARCHIVE)
COMPONENT_SIG_URL= $(COMPONENT_ARCHIVE_URL).asc
COMPONENT_ARCHIVE_HASH= sha256:43b8e3b4680968903a3510de26bf7e816ba77eb26c84054646aad98403a94c19
COMPONENT_LICENSE=

COMPONENT_ARCHIVE_1 = 0168229624cfac409e766913506961a8-ucpp-1.3.2.tar.gz
COMPONENT_ARCHIVE_HASH_1 = sha256:983941d31ee8d366085cadf28db75eb1f5cb03ba1e5853b98f12f7f51c63b776
COMPONENT_ARCHIVE_URL_1 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_1)

COMPONENT_ARCHIVE_2 = 1f5def51ca0026cd192958ef07228b52-rasqal-0.9.33.tar.gz
OMPONENT_ARCHIVE_HASH_2 = sha256:6924c9ac6570bd241a9669f83b467c728a322470bf34f4b2da4f69492ccfd97c
COMPONENT_ARCHIVE_URL_2 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_2)

COMPONENT_ARCHIVE_3 = 26b3e95ddf3d9c077c480ea45874b3b8-lp_solve_5.5.tar.gz
COMPONENT_ARCHIVE_HASH_3 = sha256:171816288f14215c69e730f7a4f1c325739873e21f946ff83884b350574e6695
COMPONENT_ARCHIVE_URL_3 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_3)

COMPONENT_ARCHIVE_4 = 48d647fbd8ef8889e5a7f422c1bfda94-clucene-core-2.3.3.4.tar.gz
COMPONENT_ARCHIVE_HASH_4 = sha256:ddfdc433dd8ad31b5c5819cc4404a8d2127472a3b720d3e744e8c51d79732eab
COMPONENT_ARCHIVE_URL_4 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_4)

COMPONENT_ARCHIVE_5 = 5ade6ae2a99bc1e9e57031ca88d36dad-hyphen-2.8.8.tar.gz
COMPONENT_ARCHIVE_HASH_5 = sha256:304636d4eccd81a14b6914d07b84c79ebb815288c76fe027b9ebff6ff24d5705
COMPONENT_ARCHIVE_URL_5 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_5)

COMPONENT_ARCHIVE_6 = 884ed41809687c3e168fc7c19b16585149ff058eca79acbf3ee784f6630704cc-opens___.ttf
COMPONENT_ARCHIVE_HASH_6 = sha256:884ed41809687c3e168fc7c19b16585149ff058eca79acbf3ee784f6630704cc
COMPONENT_ARCHIVE_URL_6 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_6)

COMPONENT_ARCHIVE_7 = a233181e03d3c307668b4c722d881661-mariadb_client-2.0.0-src.tar.gz
COMPONENT_ARCHIVE_HASH_7 = sha256:fd2f751dea049c1907735eb236aeace1d811d6a8218118b00bbaa9b84dc5cd60
COMPONENT_ARCHIVE_URL_7 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_7)

COMPONENT_ARCHIVE_8 = a39f6c07ddb20d7dd2ff1f95fa21e2cd-raptor2-2.0.15.tar.gz
COMPONENT_ARCHIVE_HASH_8 = sha256:ada7f0ba54787b33485d090d3d2680533520cd4426d2f7fb4782dd4a6a1480ed
COMPONENT_ARCHIVE_URL_8 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_8)

COMPONENT_ARCHIVE_9 = a8c2c5b8f09e7ede322d5c602ff6a4b6-mythes-1.2.4.tar.gz
COMPONENT_ARCHIVE_HASH_9 = sha256:1e81f395d8c851c3e4e75b568e20fa2fa549354e75ab397f9de4b0e0790a305f
COMPONENT_ARCHIVE_URL_9 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_9)

COMPONENT_ARCHIVE_10 = bae83fa5dc7f081768daace6e199adc3-glm-0.9.4.6-libreoffice.zip
COMPONENT_ARCHIVE_HASH_10 = sha256:d0312c360efe04dd048b3311fe375ff36f1993b4c2e3cb58c81062990532904a
COMPONENT_ARCHIVE_URL_10 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_10)

COMPONENT_ARCHIVE_11 = CoinMP-1.7.6.tgz
COMPONENT_ARCHIVE_HASH_11 = sha256:86c798780b9e1f5921fe4efe651a93cb420623b45aa1fdff57af8c37f116113f
COMPONENT_ARCHIVE_URL_11 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_11)

COMPONENT_ARCHIVE_12 = e5be03eda13ef68aabab6e42aa67715e-redland-1.0.17.tar.gz
COMPONENT_ARCHIVE_HASH_12 = sha256:de1847f7b59021c16bdc72abb4d8e2d9187cd6124d69156f3326dd34ee043681
COMPONENT_ARCHIVE_URL_12 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_12)

COMPONENT_ARCHIVE_13 = language-subtag-registry-2019-09-16.tar.bz2
COMPONENT_ARCHIVE_HASH_13 = sha256:07b66bc0f2786fde55f6bbcbcb4a455a846eb8e2351c8ce3d0a219a73693736a
COMPONENT_ARCHIVE_URL_13 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_13)

COMPONENT_ARCHIVE_14 = libabw-0.1.3.tar.xz
COMPONENT_ARCHIVE_HASH_14 = sha256:e763a9dc21c3d2667402d66e202e3f8ef4db51b34b79ef41f56cacb86dcd6eed
COMPONENT_ARCHIVE_URL_14 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_14)

COMPONENT_ARCHIVE_15 = libcmis-0.5.2.tar.xz
COMPONENT_ARCHIVE_HASH_15 = sha256:d7b18d9602190e10d437f8a964a32e983afd57e2db316a07d87477a79f5000a2
COMPONENT_ARCHIVE_URL_15 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_15)

COMPONENT_ARCHIVE_16 = libe-book-0.1.3.tar.xz
COMPONENT_ARCHIVE_HASH_16 = sha256:7e8d8ff34f27831aca3bc6f9cc532c2f90d2057c778963b884ff3d1e34dfe1f9
COMPONENT_ARCHIVE_URL_16 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_16)

COMPONENT_ARCHIVE_17 = libepubgen-0.1.1.tar.xz
COMPONENT_ARCHIVE_HASH_17 = sha256:03e084b994cbeffc8c3dd13303b2cb805f44d8f2c3b79f7690d7e3fc7f6215ad
COMPONENT_ARCHIVE_URL_17 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_17)

COMPONENT_ARCHIVE_18 = libetonyek-0.1.9.tar.xz
COMPONENT_ARCHIVE_HASH_18 = sha256:e61677e8799ce6e55b25afc11aa5339113f6a49cff031f336e32fa58635b1a4a
COMPONENT_ARCHIVE_URL_18 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_18)

COMPONENT_ARCHIVE_19 = libexttextcat-3.4.5.tar.xz
COMPONENT_ARCHIVE_HASH_19 = sha256:13fdbc9d4c489a4d0519e51933a1aa21fe3fb9eb7da191b87f7a63e82797dac8
COMPONENT_ARCHIVE_URL_19 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_19)

COMPONENT_ARCHIVE_20 = libfreehand-0.1.2.tar.xz
COMPONENT_ARCHIVE_HASH_20 = sha256:0e422d1564a6dbf22a9af598535425271e583514c0f7ba7d9091676420de34ac
COMPONENT_ARCHIVE_URL_20 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_20)

COMPONENT_ARCHIVE_21 = liblangtag-0.6.2.tar.bz2
COMPONENT_ARCHIVE_HASH_21 = sha256:d6242790324f1432fb0a6fae71b6851f520b2c5a87675497cf8ea14c2924d52e
COMPONENT_ARCHIVE_URL_21 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_21)

COMPONENT_ARCHIVE_22 = libmwaw-0.3.15.tar.xz
COMPONENT_ARCHIVE_HASH_22 = sha256:0440bb09f05e3419423d8dfa36ee847056ebfd837f9cbc091fdb5b057daab0b1
COMPONENT_ARCHIVE_URL_22 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_22)

COMPONENT_ARCHIVE_23 = libnumbertext-1.0.5.tar.xz
COMPONENT_ARCHIVE_HASH_23 = sha256:e1c9086b4cecb6b25f180316f30740dfabe6a4dbaf70dddc34276fc839e4f4f7
COMPONENT_ARCHIVE_URL_23 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_23)

COMPONENT_ARCHIVE_24 = liborcus-0.15.3.tar.gz
COMPONENT_ARCHIVE_HASH_24 = sha256:0dd26f3f2e611c51df9ee02d6dbf08887989eaa417b73f6877cd0d94df795fc2
COMPONENT_ARCHIVE_URL_24 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_24)

COMPONENT_ARCHIVE_25 = libpagemaker-0.0.4.tar.xz
COMPONENT_ARCHIVE_HASH_25 = sha256:66adacd705a7d19895e08eac46d1e851332adf2e736c566bef1164e7a442519d
COMPONENT_ARCHIVE_URL_25 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_25)

COMPONENT_ARCHIVE_26 = libqxp-0.0.2.tar.xz
COMPONENT_ARCHIVE_HASH_26 = sha256:e137b6b110120a52c98edd02ebdc4095ee08d0d5295a94316a981750095a945c
COMPONENT_ARCHIVE_URL_26 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_26)

COMPONENT_ARCHIVE_27 = libstaroffice-0.0.6.tar.xz
COMPONENT_ARCHIVE_HASH_27 = sha256:6b00e1ed8194e6072be4441025d1b888e39365727ed5b23e0e8c92c4009d1ec4
COMPONENT_ARCHIVE_URL_27 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_27)

COMPONENT_ARCHIVE_28 = libzmf-0.0.2.tar.xz
COMPONENT_ARCHIVE_HASH_28 = sha256:27051a30cb057fdb5d5de65a1f165c7153dc76e27fe62251cbb86639eb2caf22
COMPONENT_ARCHIVE_URL_28 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_28)

COMPONENT_ARCHIVE_29 = mdds-1.5.0.tar.bz2
COMPONENT_ARCHIVE_HASH_29 = sha256:144d6debd7be32726f332eac14ef9f17e2d3cf89cb3250eb31a7127e0789680d
COMPONENT_ARCHIVE_URL_29 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_29)

COMPONENT_ARCHIVE_30 = pdfium-3963.tar.bz2
COMPONENT_ARCHIVE_HASH_30 = sha256:80d4d6bd8faec226936fcde5521c6e92c0c645126ac3ae72dd2c160ca1749895
COMPONENT_ARCHIVE_URL_30 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_30)

COMPONENT_ARCHIVE_31 = QR-Code-generator-1.4.0.tar.gz
COMPONENT_ARCHIVE_HASH_31 = sha256:fcdf9fd69fde07ae4dca2351d84271a9de8093002f733b77c70f52f1630f6e4a
COMPONENT_ARCHIVE_URL_31 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_31)

COMPONENT_ARCHIVE_32 = xmlsec1-1.2.28.tar.gz
COMPONENT_ARCHIVE_HASH_32 = sha256:13eec4811ea30e3f0e16a734d1dbf7f9d246a71d540b48d143a07b489f6222d4
COMPONENT_ARCHIVE_URL_32 = https://dev-www.libreoffice.org/src/$(COMPONENT_ARCHIVE_32)

COMPONENT_ARCHIVE_33 = libreoffice-translations-$(COMPONENT_FULL_VERSION).tar.xz
COMPONENT_ARCHIVE_HASH_33 = sha256:0e20c35d8b39f6e0acd8f898b6ad308a364271e38b0ca65481f6548f888b3dce
COMPONENT_ARCHIVE_URL_33 = https://download.documentfoundation.org/libreoffice/src/$(COMPONENT_VERSION)/$(COMPONENT_ARCHIVE_33)

COMPONENT_ARCHIVE_34 = libreoffice-dictionaries-$(COMPONENT_FULL_VERSION).tar.xz
COMPONENT_ARCHIVE_HASH_34 = sha256:015678624c807c113ae65ef29f03860ee094cbd518046716b93a615ba21d05eb
COMPONENT_ARCHIVE_URL_34 = https://download.documentfoundation.org/libreoffice/src/$(COMPONENT_VERSION)/$(COMPONENT_ARCHIVE_34)

NUM_EXTRA_ARCHIVES = $(shell seq 1 34)

GCC_VERSION=7

include $(WS_MAKE_RULES)/common.mk

PATH=$(GCC_ROOT)/bin:$(PATH.gnu)

COMPONENT_BUILD_ENV=   CONFIG_SHELL="$(CONFIG_SHELL)"
COMPONENT_BUILD_ENV+=  SHELL="$(CONFIG_SHELL)"
#COMPONENT_BUILD_ENV+= PATH="$(PATH)"
COMPONENT_BUILD_ENV+=  CC="$(CC)"
COMPONENT_BUILD_ENV+=  CXX="$(CXX)"

CONFIGURE_ENV = $(COMPONENT_BUILD_ENV)
CONFIGURE_ENV += PYTHON=/usr/bin/python3.5

COMPONENT_PREP_ACTION= ( mkdir -p $(@D)/external/tarballs && \
       for i in $(ARCHIVES) ; do rm -f $(@D)/external/tarballs/$$i && \
       ln -s $(USERLAND_ARCHIVES)/$$i $(@D)/external/tarballs/$$i ; done )


# build with the distribution preferred libjpeg implementation
CFLAGS   += $(JPEG_CPPFLAGS) $(JPEG_CFLAGS)
CXXFLAGS += $(JPEG_CPPFLAGS) $(JPEG_CXXFLAGS)
LDFLAGS  += $(JPEG_LDFLAGS)

CONFIGURE_OPTIONS += --with-myspell-dicts
CONFIGURE_OPTIONS += --with-help=common
CONFIGURE_OPTIONS += --enable-release-build
CONFIGURE_OPTIONS += --enable-gstreamer-1-0
CONFIGURE_OPTIONS += --disable-odk
CONFIGURE_OPTIONS += --with-system-cairo
CONFIGURE_OPTIONS += --with-system-expat
CONFIGURE_OPTIONS += --with-system-libxml
CONFIGURE_OPTIONS += --with-system-icu
CONFIGURE_OPTIONS += --with-system-poppler
CONFIGURE_OPTIONS += --with-system-curl
CONFIGURE_OPTIONS += --with-system-boost
CONFIGURE_OPTIONS += --with-system-nss
CONFIGURE_OPTIONS += --with-system-apr
CONFIGURE_OPTIONS += --with-system-neon
CONFIGURE_OPTIONS += --with-system-openssl
CONFIGURE_OPTIONS += --with-system-libpng
CONFIGURE_OPTIONS += --with-system-jpeg
CONFIGURE_OPTIONS += --with-system-harfbuzz
CONFIGURE_OPTIONS += --with-system-graphite
CONFIGURE_OPTIONS += --with-system-cppunit
CONFIGURE_OPTIONS += --with-system-lcms2
CONFIGURE_OPTIONS += --with-system-dicts
CONFIGURE_OPTIONS += --with-system-epoxy
CONFIGURE_OPTIONS += --with-system-hunspell
CONFIGURE_OPTIONS += --with-system-libwps
CONFIGURE_OPTIONS += --with-system-libwpg
CONFIGURE_OPTIONS += --with-system-libwpd
CONFIGURE_OPTIONS += --with-system-libmspub
CONFIGURE_OPTIONS += --with-system-librevenge
CONFIGURE_OPTIONS += --with-system-libodfgen
CONFIGURE_OPTIONS += --with-system-libvisio
CONFIGURE_OPTIONS += --with-system-libcdr
CONFIGURE_OPTIONS += --enable-gio
CONFIGURE_OPTIONS += --with-lang=ALL
CONFIGURE_OPTIONS += --disable-firebird-sdbc
CONFIGURE_OPTIONS += --disable-postgresql-sdbc
CONFIGURE_OPTIONS += --with-java=no
CONFIGURE_OPTIONS += --without-help
CONFIGURE_OPTIONS += --without-fonts
CONFIGURE_OPTIONS += --enable-cups
CONFIGURE_OPTIONS += --with-epm=internal
CONFIGURE_OPTIONS += --with-vendor="OpenIndiana"
CONFIGURE_OPTIONS += --with-tls="openssl"
CONFIGURE_OPTIONS += --with-system-openldap
CONFIGURE_OPTIONS += --enable-python=no
CONFIGURE_OPTIONS += --disable-cve-tests

# Build dependencies
REQUIRED_PACKAGES += developer/assembler/nasm
REQUIRED_PACKAGES += file/gnu-coreutils
