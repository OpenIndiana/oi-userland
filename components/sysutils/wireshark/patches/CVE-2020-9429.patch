Patch cherry picked from upstream:
https://github.com/wireshark/wireshark

commit a2530f740d67d41908e84434bb5ec99480c2ac2e
Author: Peter Wu <peter@lekensteyn.nl>
Date:   Sat Feb 22 12:15:42 2020 +0000

    WireGuard: ignore messages with invalid lengths

    A UDP payload of 543 bytes can never be a valid Handshake Initiation
    message for example. Reject such messages to avoid user confusion.

    Bug: 16394
    Change-Id: Ia40ae24f8ff8abaf2bead54cbf091db907b66373
    Reviewed-on: https://code.wireshark.org/review/36149
    Petri-Dish: Peter Wu <peter@lekensteyn.nl>
    Tested-by: Petri Dish Buildbot
    Reviewed-by: Alexis La Goutte <alexis.lagoutte@gmail.com>

diff --git a/epan/dissectors/packet-wireguard.c b/epan/dissectors/packet-wireguard.c
index 24d6166018..15eda2a1c1 100644
--- a/epan/dissectors/packet-wireguard.c
+++ b/epan/dissectors/packet-wireguard.c
@@ -1575,6 +1575,23 @@ wg_dissect_data(tvbuff_t *tvb, packet_info *pinfo, proto_tree *wg_tree, wg_packe
     return 16 + packet_length;
 }
 
+static gboolean
+wg_is_valid_message_length(guint8 message_type, guint length)
+{
+    switch (message_type) {
+    case WG_TYPE_HANDSHAKE_INITIATION:
+        return length == 148;
+    case WG_TYPE_HANDSHAKE_RESPONSE:
+        return length == 92;
+    case WG_TYPE_COOKIE_REPLY:
+        return length == 64;
+    case WG_TYPE_TRANSPORT_DATA:
+        return length >= 32;
+    default:
+        return FALSE;
+    }
+}
+
 static int
 dissect_wg(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void *data _U_)
 {
@@ -1589,6 +1606,10 @@ dissect_wg(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void *data _U_)
     if (!message_type_str)
         return 0;
 
+    if (!wg_is_valid_message_length(message_type, tvb_reported_length(tvb))) {
+        return 0;
+    }
+
     /* Special case: zero-length data message is a Keepalive message. */
     if (message_type == WG_TYPE_TRANSPORT_DATA && tvb_reported_length(tvb) == 32) {
         message_type_str = "Keepalive";
@@ -1653,33 +1674,16 @@ dissect_wg_heur(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void *data
     message_type = tvb_get_guint8(tvb, 0);
     reserved_is_zeroes = tvb_get_ntoh24(tvb, 1) == 0;
 
-    switch (message_type) {
-        case WG_TYPE_HANDSHAKE_INITIATION:
-            if (tvb_reported_length(tvb) != 148)
-                return FALSE;
-            break;
-
-        case WG_TYPE_HANDSHAKE_RESPONSE:
-            if (tvb_reported_length(tvb) != 92)
-                return FALSE;
-            break;
+    if (!wg_is_valid_message_length(message_type, tvb_reported_length(tvb))) {
+        return FALSE;
+    }
 
+    switch (message_type) {
         case WG_TYPE_COOKIE_REPLY:
-            if (tvb_reported_length(tvb) != 64)
-                return FALSE;
-            if (!reserved_is_zeroes)
-                return FALSE;
-            break;
-
         case WG_TYPE_TRANSPORT_DATA:
-            if (tvb_reported_length(tvb) < 32)
-                return FALSE;
             if (!reserved_is_zeroes)
                 return FALSE;
             break;
-
-        default:
-            return FALSE;
     }
 
     /*
