From b7923d8eab6c340b985e6714780f9594cc435a68 Mon Sep 17 00:00:00 2001
From: Cristy <urban-warrior@imagemagick.org>
Date: Wed, 8 Feb 2017 13:38:04 -0500
Subject: [PATCH] Fix an out of bound error in sun file handling

bug: https://github.com/ImageMagick/ImageMagick/issues/375
bug: https://github.com/ImageMagick/ImageMagick/issues/376
bug-debian: https://bugs.debian.org/856879
origin: https://github.com/ImageMagick/ImageMagick/commit/3007531bfd326c5c1e29cd41d2cd80c166de8528

(cherry picked from commit 3007531bfd326c5c1e29cd41d2cd80c166de8528)
---
 coders/sun.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/coders/sun.c b/coders/sun.c
index 150f3357f..c11a33c62 100644
--- a/coders/sun.c
+++ b/coders/sun.c
@@ -458,7 +458,7 @@ static Image *ReadSUNImage(const ImageInfo *image_info,ExceptionInfo *exception)
         ThrowReaderException(ResourceLimitError,"ImproperImageHeader");
       }
     pixels_length=height*bytes_per_line;
-    sun_pixels=(unsigned char *) AcquireQuantumMemory(pixels_length,
+    sun_pixels=(unsigned char *) AcquireQuantumMemory(pixels_length+image->rows,
       sizeof(*sun_pixels));
     if (sun_pixels == (unsigned char *) NULL)
       {
