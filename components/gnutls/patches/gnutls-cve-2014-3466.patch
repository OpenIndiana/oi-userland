From 89238044ade02c4d80e334ab74056ef28599663d Mon Sep 17 00:00:00 2001
From: Nikos Mavrogiannopoulos <nmav@gnutls.org>
Date: Fri, 23 May 2014 19:53:03 +0200
Subject: [PATCH] Prevent memory corruption due to server hello parsing.

Issue discovered by Joonas Kuorilehto of Codenomicon.
---
 lib/gnutls_handshake.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

Index: gnutls26-2.8.5/lib/gnutls_handshake.c
===================================================================
--- gnutls26-2.8.5.orig/lib/gnutls_handshake.c	2014-06-01 11:05:17.100976740 -0400
+++ gnutls26-2.8.5/lib/gnutls_handshake.c	2014-06-01 11:05:17.088976740 -0400
@@ -1518,7 +1518,7 @@
   DECR_LEN (len, 1);
   session_id_len = data[pos++];
 
-  if (len < session_id_len)
+  if (len < session_id_len || session_id_len > TLS_MAX_SESSION_ID_SIZE)
     {
       gnutls_assert ();
       return GNUTLS_E_UNSUPPORTED_VERSION_PACKET;
