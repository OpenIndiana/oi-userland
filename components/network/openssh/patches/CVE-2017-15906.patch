--- openssh-7.4p1/sftp-server.c.1	2018-10-19 07:32:46.949104326 +0000
+++ openssh-7.4p1/sftp-server.c	2018-10-19 07:35:09.016180822 +0000
@@ -694,8 +694,8 @@
 	logit("open \"%s\" flags %s mode 0%o",
 	    name, string_from_portable(pflags), mode);
 	if (readonly &&
-	    ((flags & O_ACCMODE) == O_WRONLY ||
-	    (flags & O_ACCMODE) == O_RDWR)) {
+	    ((flags & O_ACCMODE) != O_RDONLY ||
+	    (flags & (O_CREAT|O_TRUNC)) != 0)) {
 		verbose("Refusing open request in read-only mode");
 		status = SSH2_FX_PERMISSION_DENIED;
 	} else {
